#!/bin/bash

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Original commands
commands=(
    "RAM Copy"
    "Recover Deleted"
    "Repair Archive"
    "Safe Open"
    "Quit"
)

# Sort commands alphabetically but keep "Quit" at the bottom
sorted_commands=($(printf "%s\n" "${commands[@]}" | grep -v "Quit" | sort))
sorted_commands+=("Quit")

commands=("${sorted_commands[@]}")  # Replace original with sorted

selected=0

# Function to display the list and highlight the selected item
display_list() {
    clear
    echo -e "\033[1m  Data Recovery Tools\033[0m\n  -------------------"
    for i in "${!commands[@]}"; do
        if [ $i -eq $selected ]; then
            echo -e "\033[1mâž¤ ${commands[$i]}\033[0m\n"
        else
            echo -e "  ${commands[$i]}\n"
        fi
    done
}

# Function to execute the selected command
execute_command() {
    case ${commands[$selected]} in
        "RAM Copy") 
            "${SCRIPT_DIR}/tools/ram-copy"
            read -p "Press Enter to return to the menu..."
            ;;
        "Recover Deleted")
            "${SCRIPT_DIR}/tools/recover-deleted"
            read -p "Press Enter to return to the menu..."
            ;;
        "Repair Archive")
            "${SCRIPT_DIR}/tools/repair-archive"
            read -p "Press Enter to return to the menu..."
            ;;
        "Safe Open")
            "${SCRIPT_DIR}/tools/safe-open"
            read -p "Press Enter to return to the menu..."
            ;;            
        "Quit") 
            echo -e "\n\033[1mExiting script\033[0m"
            exit 0
            ;;
        *) 
            echo -e "\nInvalid selection"
            ;;
    esac
}

# Main loop
while true; do
    display_list

    read -sn 1 key

    case $key in
        "A") ((selected--)); [ $selected -lt 0 ] && selected=$(( ${#commands[@]} - 1 ));;
        "B") ((selected++)); [ $selected -ge ${#commands[@]} ] && selected=0 ;;
        "") execute_command ;;
        *) ;;
    esac
done
